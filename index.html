<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é—®é“é•¿ç”Ÿ - ä»™ä¾ æ”¾ç½®</title>
    <link rel="stylesheet" href="css/mobile.css?v=6">
</head>
<body>
    <div class="game-wrap">
        <header class="header">
            <h1>é—®é“é•¿ç”Ÿ</h1>
            <div class="info-row">
                <div class="info-item realm">
                    <div class="label">å¢ƒç•Œ</div>
                    <div class="value"><span id="realm-name">ç»ƒæ°”</span> <span id="realm-level">(1å±‚)</span></div>
                </div>
                <div class="info-item spirit">
                    <div class="label">çµæ°”</div>
                    <div class="value"><span id="spirit-amount">0</span></div>
                </div>
            </div>
        </header>

        <nav class="nav">
            <button class="nav-btn active" data-tab="home" onclick="showTab('home')">é¦–é¡µ</button>
            <button class="nav-btn" data-tab="dungeon" onclick="showTab('dungeon')">å‰¯æœ¬</button>
            <button class="nav-btn" data-tab="pet" onclick="showTab('pet')">çµå® </button>
            <button class="nav-btn" data-tab="sect" onclick="showTab('sect')">å®—é—¨</button>
            <button class="nav-btn" data-tab="shop" onclick="showTab('shop')">å•†åº—</button>
        </nav>

        <main class="content">
            <!-- é¦–é¡µ -->
            <section id="home-panel" class="panel active">
                <h2>ğŸ  ä¿®ç‚¼çŠ¶æ€</h2>
                
                <!-- å¢ƒç•Œ -->
                <div class="card">
                    <h3>ğŸŒŸ å½“å‰å¢ƒç•Œ</h3>
                    <div class="realm-info">
                        <span class="big-text" id="realm-text">ç»ƒæ°”æœŸ ç¬¬1å±‚</span>
                    </div>
                    <div class="progress-section">
                        <div class="progress-bar"><div id="progress-bar" class="progress-fill" style="width:0%"></div></div>
                        <p><span id="cultivation">0</span> / <span id="need">100</span></p>
                    </div>
                </div>

                <!-- æŒ‚æœº -->
                <div class="card">
                    <h3>âš¡ æŒ‚æœºä¿®ç‚¼</h3>
                    <p>å½“å‰æŒ‚æœº: <span id="æŒ‚æœºä¸­">æ— </span></p>
                    <div class="btn-group" style="margin-top:10px;">
                        <button class="btn btn-primary" onclick="startæŒ‚æœº()">å¼€å§‹æŒ‚æœº</button>
                        <button class="btn btn-warning" onclick="stopæŒ‚æœº()">åœæ­¢</button>
                    </div>
                    <p style="margin-top:10px;font-size:0.8rem;color:#888;">æ¯ç§’è‡ªåŠ¨è·å¾—çµæ°”ï¼Œå…³é—­é¡µé¢ä¹Ÿèƒ½ç»§ç»­ï¼</p>
                </div>

                <!-- çµæ ¹ -->
                <div class="card">
                    <h3>ğŸŒ¿ çµæ ¹</h3>
                    <div id="roots-display" class="roots-grid"></div>
                    <button class="btn btn-primary" style="width:100%;margin-top:10px;" onclick="upgradeRoot()">å‡çº§çµæ ¹ (æ¶ˆè€—çµæ°”)</button>
                </div>

                <!-- æˆ˜åŠ› -->
                <div class="card">
                    <h3>ğŸ’ª æˆ˜åŠ›</h3>
                    <p id="combat">0</p>
                </div>
            </section>

            <!-- å‰¯æœ¬ -->
            <section id="dungeon-panel" class="panel">
                <h2>ğŸ”ï¸ å‰¯æœ¬æŒ‚æœº</h2>
                
                <div class="dungeon-list" id="dungeon-list">
                    <!-- å‰¯æœ¬åˆ—è¡¨ -->
                </div>

                <div class="card" style="margin-top:15px;">
                    <h3>â›ï¸ é‡‡é›†</h3>
                    <p>æ´¾é£çµå® é‡‡é›†èµ„æº</p>
                    <div class="btn-group" style="margin-top:10px;">
                        <button class="btn btn-primary" onclick="starté‡‡é›†()">é‡‡é›†çµè„‰</button>
                    </div>
                    <p style="margin-top:10px;font-size:0.8rem;color:#888;" id="é‡‡é›†çŠ¶æ€">æœªé‡‡é›†</p>
                </div>
            </section>

            <!-- çµå®  -->
            <section id="pet-panel" class="panel">
                <h2>ğŸ² çµå® </h2>
                
                <div class="card">
                    <h3>æˆ‘çš„çµå® </h3>
                    <div id="my-pet" style="text-align:center;padding:20px;">
                        <div style="font-size:3rem;">ğŸ¥š</div>
                        <p>æš‚æ— çµå® </p>
                    </div>
                </div>

                <div class="card">
                    <h3>æ•æ‰çµå® </h3>
                    <div class="btn-group">
                        <button class="btn btn-primary" onclick="æ•æ‰()">æ•æ‰ (500çµæ°”)</button>
                    </div>
                </div>

                <div class="card">
                    <h3>çµå® åˆ—è¡¨</h3>
                    <div id="pet-list"></div>
                </div>
            </section>

            <!-- å®—é—¨ -->
            <section id="sect-panel" class="panel">
                <h2>ğŸ›ï¸ å®—é—¨</h2>
                
                <div class="card">
                    <h3>å®—é—¨å»ºç­‘</h3>
                    <div class="building-item">
                        <span>ğŸ§˜ ä¿®ç‚¼å®¤ Lv.<span id="b-train">0</span></span>
                        <button class="btn" onclick="upgradeBuilding('train')">å‡çº§</button>
                    </div>
                    <div class="building-item">
                        <span>â›ï¸ çŸ¿è„‰ Lv.<span id="b-mine">0</span></span>
                        <button class="btn" onclick="upgradeBuilding('mine')">å‡çº§</button>
                    </div>
                    <div class="building-item">
                        <span>ğŸ  æ®¿å ‚ Lv.<span id="b-hall">0</span></span>
                        <button class="btn" onclick="upgradeBuilding('hall')">å‡çº§</button>
                    </div>
                </div>
            </section>

            <!-- å•†åº— -->
            <section id="shop-panel" class="panel">
                <h2>ğŸª å•†åº—</h2>
                
                <div class="shop-item"><span>ğŸ’Š çµæ°”ä¸¹</span><button onclick="buy('spirit')">100</button></div>
                <div class="shop-item"><span>ğŸ çµæ ¹æœ</span><button onclick="buy('root')">200</button></div>
                <div class="shop-item"><span>ğŸ« æ•æ‰ç¬¦</span><button onclick="buy('catch')">300</button></div>
                <div class="shop-item"><span>âš¡ åŠ é€Ÿå¡</span><button onclick="buy('speed')">500</button></div>
            </section>
        </main>
    </div>

    <script>
    // æ¸¸æˆæ•°æ®
    const REALMS = ['ç»ƒæ°”','ç­‘åŸº','é‡‘ä¸¹','å…ƒå©´','åŒ–ç¥','ç‚¼è™š','åˆä½“','å¤§ä¹˜','æ¸¡åŠ«','ä»™äºº'];
    const DUNGEONS = [
        {n:'çµæ°”æ´å¤©',l:1,r:1,d:'åŸºç¡€çµæ°”å‰¯æœ¬'},
        {n:'é’äº‘å±±',l:10,r:5,d:'çµæ°”+50%'},
        {n:'ä¸‡å…½å›­',l:20,r:10,d:'çµæ°”+100%'},
        {n:'æ˜Ÿè¾°æµ·',l:30,r:20,d:'çµæ°”+200%'},
        {n:'ä»™çµæ± ',l:40,r:50,d:'çµæ°”+500%'},
        {n:'å¤©é“å®«',l:50,r:100,d:'çµæ°”+1000%'}
    ];
    const PETS = [
        {n:'å°è›‡',a:5,v:'ğŸ'},
        {n:'ç™½è™',a:15,v:'ğŸ¯'},
        {n:'é’é¾™',a:30,v:'ğŸ‰'},
        {n:'æœ±é›€',a:25,v:'ğŸ¦…'},
        {n:'ç„æ­¦',a:10,v:'ğŸ¢'},
        {n:'éº’éºŸ',a:50,v:'ğŸ¦„'}
    ];
    const ELEMENTS = ['é‡‘','æœ¨','æ°´','ç«','åœŸ'];
    
    let game = {
        spirit: 0, realm: 0, realmLv: 1, cult: 0,
        roots: [1,1,1,1,1], rootLv: 1,
        pet: null, petLv: 1,
        æŒ‚æœºä¸­: false, æŒ‚æœºå‰¯æœ¬: 0,
        é‡‡é›†: false,
        sect: {train:0, mine:0, hall:0},
        lastSave: Date.now()
    };

    function load() {
        try {
            let d = localStorage.getItem('xianxia_save');
            if(d) {
                game = {...game, ...JSON.parse(d)};
                // è®¡ç®—ç¦»çº¿æ”¶ç›Š
                let offline = (Date.now() - game.lastSave) / 1000;
                if(offline > 60) {
                    let gain = getRate() * offline * 0.5;
                    game.spirit += gain;
                    alert('ç¦»çº¿æ”¶ç›Š: +' + Math.floor(gain) + 'çµæ°”');
                }
            }
        } catch(e) {}
        render();
    }

    function save() {
        game.lastSave = Date.now();
        localStorage.setItem('xianxia_save', JSON.stringify(game));
    }

    function getRate() {
        let r = (game.realm + 1) * game.realmLv * (game.æŒ‚æœºå‰¯æœ¬ > 0 ? DUNGEONS[game.æŒ‚æœºå‰¯æœ¬].r : 1);
        r *= (1 + game.roots.reduce((a,b)=>a+b,0) * 0.1);
        r *= (1 + game.sect.train * 0.2);
        return r;
    }

    function getNeed() {
        return Math.floor(100 * Math.pow(1.5, game.realmLv));
    }

    function å¢ƒç•Œçªç ´() {
        if(game.cult >= getNeed()) {
            game.cult = 0;
            if(game.realmLv < 10) game.realmLv++;
            else if(game.realm < 9) { game.realm++; game.realmLv = 1; }
        }
        render();
    }

    function startæŒ‚æœº() {
        game.æŒ‚æœºä¸­ = true;
        document.getElementById('æŒ‚æœºä¸­').textContent = DUNGEONS[game.æŒ‚æœºå‰¯æœ¬].n;
        render();
    }

    function stopæŒ‚æœº() {
        game.æŒ‚æœºä¸­ = false;
        document.getElementById('æŒ‚æœºä¸­').textContent = 'æ— ';
        render();
    }

    function selectDungeon(i) {
        if(game.realm >= DUNGEONS[i].l) {
            game.æŒ‚æœºå‰¯æœ¬ = i;
            if(game.æŒ‚æœºä¸­) {
                document.getElementById('æŒ‚æœºä¸­').textContent = DUNGEONS[i].n;
            }
            render();
        }
    }

    function starté‡‡é›†() {
        game.é‡‡é›† = true;
        document.getElementById('é‡‡é›†çŠ¶æ€').textContent = 'é‡‡é›†ä¸­...';
        render();
    }

    function upgradeRoot() {
        let cost = Math.floor(10 * Math.pow(1.5, game.rootLv));
        if(game.spirit >= cost) {
            game.spirit -= cost;
            game.rootLv++;
            game.roots[Math.floor(Math.random()*5)]++;
        }
        render();
    }

    function upgradeBuilding(type) {
        let cost = {train:1000, mine:800, hall:1200}[type] * Math.pow(1.5, game.sect[type]);
        if(game.spirit >= cost) {
            game.spirit -= cost;
            game.sect[type]++;
        }
        render();
    }

    function æ•æ‰() {
        if(game.spirit >= 500) {
            game.spirit -= 500;
            game.pet = PETS[Math.floor(Math.random() * PETS.length)];
            game.petLv = 1;
        }
        render();
    }

    function buy(item) {
        let cost = {spirit:100, root:200, catch:300, speed:500}[item];
        if(game.spirit >= cost) {
            game.spirit -= cost;
            if(item === 'spirit') game.rootLv += 1;
            else if(item === 'root') game.roots = game.roots.map(r=>r+5);
            else if(item === 'catch') game.pet = PETS[Math.floor(Math.random()*PETS.length)];
            else if(item === 'speed') game.spirit += getRate() * 300;
        }
        render();
    }

    function showTab(t) {
        document.querySelectorAll('.nav-btn').forEach(b=>b.classList.remove('active'));
        document.querySelectorAll('.panel').forEach(p=>p.classList.remove('active'));
        document.querySelector('[data-tab="'+t+'"]').classList.add('active');
        document.getElementById(t+'-panel').classList.add('active');
    }

    function render() {
        document.getElementById('realm-name').textContent = REALMS[game.realm];
        document.getElementById('realm-level').textContent = '('+game.realmLv+'å±‚)';
        document.getElementById('spirit-amount').textContent = Math.floor(game.spirit).toLocaleString();
        
        let need = getNeed();
        document.getElementById('realm-text').textContent = REALMS[game.realm] + 'æœŸ ç¬¬' + game.realmLv + 'å±‚';
        document.getElementById('cultivation').textContent = Math.floor(game.cult);
        document.getElementById('need').textContent = need;
        document.getElementById('progress-bar').style.width = (game.cult/need*100)+'%';
        
        document.getElementById('roots-display').innerHTML = ELEMENTS.map((e,i)=>
            '<span class="root '+(game.roots[i]>5?'active':'')+'">'+e+':'+game.roots[i]+'</span>'
        ).join('');
        
        document.getElementById('combat').textContent = Math.floor(getRate() * 10);
        
        // å‰¯æœ¬
        let dungeonHtml = '';
        DUNGEONS.forEach((d,i) => {
            let locked = game.realm < d.l;
            dungeonHtml += '<div class="dungeon-item '+(game.æŒ‚æœºå‰¯æœ¬===i?'active':'')+'" onclick="selectDungeon('+i+')" '+(locked?'style="opacity:0.5"':'')+'>';
            dungeonHtml += '<div class="dun-name">'+d.n+'</div>';
            dungeonHtml += '<div class="dun-req">'+(locked?'éœ€'+d.l+'å¢ƒ':'çµæ°”x'+d.r)+'</div>';
            dungeonHtml += '<div class="dun-desc">'+d.d+'</div>';
            dungeonHtml += '</div>';
        });
        document.getElementById('dungeon-list').innerHTML = dungeonHtml;
        
        // çµå® 
        if(game.pet) {
            document.getElementById('my-pet').innerHTML = '<div style="font-size:3rem;">'+game.pet.v+'</div><p>'+game.pet.n+' Lv.'+game.petLv+'</p><p>æ”»å‡»+'+game.pet.a+'</p>';
        }
        
        // å®—é—¨
        document.getElementById('b-train').textContent = game.sect.train;
        document.getElementById('b-mine').textContent = game.sect.mine;
        document.getElementById('b-hall').textContent = game.sect.hall;
        
        save();
    }

    // æ¸¸æˆä¸»å¾ªç¯
    setInterval(() => {
        // æŒ‚æœºè·å¾—çµæ°”
        if(game.æŒ‚æœºä¸­) {
            game.spirit += getRate() / 10;
            game.cult += game.rootLv / 10;
            å¢ƒç•Œçªç ´();
        }
        
        // é‡‡é›†
        if(game.é‡‡é›† && game.pet) {
            game.spirit += game.pet.a * game.petLv * (1 + game.sect.mine * 0.1) / 10;
        }
        
        // è‡ªåŠ¨çªç ´
        å¢ƒç•Œçªç ´();
        
        render();
    }, 100);

    // è‡ªåŠ¨ä¿å­˜
    setInterval(save, 10000);
    
    load();
    </script>
</body>
</html>
