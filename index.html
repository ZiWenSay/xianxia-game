<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é—®é“é•¿ç”Ÿ - ä»™ä¾ æ”¾ç½®</title>
    <link rel="stylesheet" href="css/mobile.css?v=8">
</head>
<body>
    <div class="game-wrap">
        <header class="header">
            <h1>é—®é“é•¿ç”Ÿ</h1>
            <div class="info-row">
                <div class="info-item">
                    <div class="label">å¢ƒç•Œ</div>
                    <div class="value realm" id="realm">ç»ƒæ°”</div>
                </div>
                <div class="info-item">
                    <div class="label">çµæ°”</div>
                    <div class="value spirit" id="spirit">0</div>
                </div>
            </div>
        </header>

        <nav class="nav">
            <button class="nav-btn active" data-tab="cultivate" onclick="showTab('cultivate')">ä¿®ç‚¼</button>
            <button class="nav-btn" data-tab="sect" onclick="showTab('sect')">å®—é—¨</button>
            <button class="nav-btn" data-tab="tech" onclick="showTab('tech')">åŠŸæ³•</button>
            <button class="nav-btn" data-tab="pet" onclick="showTab('pet')">çµå® </button>
            <button class="nav-btn" data-tab="dungeon" onclick="showTab('dungeon')">ç§˜å¢ƒ</button>
        </nav>

        <main class="content">
            <section id="cultivate-panel" class="panel active">
                <h2>ğŸ§˜ ä¿®ç‚¼</h2>
                
                <div class="card">
                    <h3>ğŸŒŸ å¢ƒç•Œ</h3>
                    <div class="big-text" id="realm-text">ç»ƒæ°”æœŸ ç¬¬1å±‚</div>
                    <div class="progress-bar"><div id="progress" class="progress-fill" style="width:0%"></div></div>
                    <p><span id="cultivation">0</span> / <span id="need">100</span></p>
                </div>

                <div class="card">
                    <h3>â›º é—­å…³ä¿®ç‚¼</h3>
                    <p>è‡ªåŠ¨è·å¾—çµæ°”ï¼Œå…³é—­é¡µé¢ä¹Ÿèƒ½ç»§ç»­ä¿®ç‚¼ï¼</p>
                    <p style="color:#00d4ff;margin:10px 0;">æ¯ç§’ +<span id="rate">1</span> çµæ°”</p>
                </div>

                <div class="card">
                    <h3>ğŸŒ¿ çµæ ¹</h3>
                    <div id="roots" class="roots-grid"></div>
                    <button class="btn btn-primary" style="width:100%;margin-top:10px;" onclick="upgradeRoot()">å‡çº§çµæ ¹</button>
                </div>
            </section>

            <section id="sect-panel" class="panel">
                <h2>ğŸ›ï¸ å®—é—¨</h2>
                
                <div class="card">
                    <h3>ğŸ° å®—é—¨å»ºç­‘</h3>
                    <div class="build-item"><span>ğŸ§˜ ä¿®ç‚¼æ®¿ Lv.<span id="b-train">0</span></span><button onclick="upgradeSect('train')">å‡çº§</button></div>
                    <div class="build-item"><span>âš—ï¸ ç‚¼ä¸¹æˆ¿ Lv.<span id="b-alchemy">0</span></span><button onclick="upgradeSect('alchemy')">å‡çº§</button></div>
                    <div class="build-item"><span>ğŸ”¨ ç‚¼å™¨æ®¿ Lv.<span id="b-forge">0</span></span><button onclick="upgradeSect('forge')">å‡çº§</button></div>
                    <div class="build-item"><span>ğŸ² çµå…½å›­ Lv.<span id="b-park">0</span></span><button onclick="upgradeSect('park')">å‡çº§</button></div>
                    <div class="build-item"><span>ğŸ›¡ï¸ æŠ¤å±±å¤§é˜µ Lv.<span id="b-array">0</span></span><button onclick="upgradeSect('array')">å‡çº§</button></div>
                </div>

                <div class="card">
                    <h3>ğŸ‘¥ å¼Ÿå­</h3>
                    <p>å¼Ÿå­æ•°: <span id="disciples">1</span> / <span id="max-disciples">5</span></p>
                    <button class="btn btn-primary" style="margin-top:10px;" onclick="recruit()">æ‹›å‹Ÿå¼Ÿå­</button>
                </div>

                <div class="card">
                    <h3>ğŸ“œ å®—é—¨ä»»åŠ¡</h3>
                    <div style="display:flex;gap:10px;margin-top:10px;">
                        <button class="btn" style="flex:1;" onclick="mission('easy')">ç®€å•</button>
                        <button class="btn" style="flex:1;" onclick="mission('normal')">ä¸­ç­‰</button>
                        <button class="btn" style="flex:1;" onclick="mission('hard')">å›°éš¾</button>
                    </div>
                    <p id="mission-status" style="margin-top:10px;font-size:0.85rem;color:#666;"></p>
                </div>
            </section>

            <section id="tech-panel" class="panel">
                <h2>ğŸ“š åŠŸæ³•</h2>
                <div id="tech-list"></div>
            </section>

            <section id="pet-panel" class="panel">
                <h2>ğŸ² çµå® </h2>
                <div class="card"><div id="my-pet" style="text-align:center;padding:20px;"><div style="font-size:3rem;">ğŸ¥š</div><p>æš‚æ— çµå® </p></div></div>
                <div class="card"><button class="btn btn-primary" style="width:100%;" onclick="catchPet()">ğŸ¯ æ•æ‰çµå® </button></div>
            </section>

            <section id="dungeon-panel" class="panel">
                <h2>ğŸ”ï¸ ç§˜å¢ƒæ¢ç´¢</h2>
                <div class="card">
                    <h3>ğŸ”® ä»Šæ—¥ç§˜å¢ƒ</h3>
                    <p id="dungeon-name">æ— </p>
                    <p style="color:#888;font-size:0.85rem;" id="dungeon-desc"></p>
                    <button class="btn btn-primary" style="width:100%;margin-top:10px;" onclick="enterDungeon()">è¿›å…¥ç§˜å¢ƒ</button>
                </div>
            </section>
        </main>
    </div>

    <script>
    const REALMS = ['ç»ƒæ°”','ç­‘åŸº','é‡‘ä¸¹','å…ƒå©´','åŒ–ç¥','ç‚¼è™š','åˆä½“','å¤§ä¹˜','æ¸¡åŠ«','ä»™äºº'];
    const TECH = [
        {n:'å¼•æ°”è¯€',d:'çµæ°”+10%',c:0},{n:'é‡‘åˆšç½©',d:'é˜²å¾¡+20%',c:100},{n:'çƒˆç„°æŒ',d:'æ”»å‡»+25%',c:200},
        {n:'æ°´äº‘è¡£',d:'ç”Ÿå‘½+30%',c:300},{n:'é’æœ¨åŠŸ',d:'çµæ°”+30%',c:500},{n:'ç´«é›·è¯€',d:'æ”»å‡»+50%',c:800},
        {n:'åšåœŸç›¾',d:'é˜²å¾¡+40%',c:1000},{n:'ä¹è½¬çµè¯€',d:'çµæ°”+50%',c:1500},{n:'å¤©é­”åŠŸ',d:'æ”»å‡»+80%',c:2000},{n:'å¤§é“ç»',d:'å…¨+30%',c:5000}
    ];
    const PETS = [{n:'é’è›‡',i:'ğŸ',a:5},{n:'ç™½è™',i:'ğŸ¯',a:15},{n:'é’é¾™',i:'ğŸ‰',a:30},{n:'æœ±é›€',i:'ğŸ¦…',a:25},{n:'ç„æ­¦',i:'ğŸ¢',a:10},{n:'éº’éºŸ',i:'ğŸ¦„',a:50}];
    const DUNGEONS = [
        {n:'çµæ°”æ´ç©´',d:'ç»ƒæ°”æœŸ',r:1,reward:'çµæ°”+100'},{n:'é’äº‘å±±',d:'ç­‘åŸºæœŸ',r:10,reward:'çµæ ¹æœ'},{n:'ä¸‡å¦–æ£®æ—',d:'é‡‘ä¸¹æœŸ',r:50,reward:'çµå® è›‹'},
        {n:'æ˜Ÿè¾°æµ·',d:'å…ƒå©´æœŸ',r:100,reward:'ä»™å“åŠŸæ³•'},{n:'ä»™çµæ± ',d:'åŒ–ç¥æœŸ',r:500,reward:'ä»™å™¨'},{n:'å¤©é“å®«',d:'æ¸¡åŠ«æœŸ',r:1000,reward:'ä»™ä½'}
    ];
    
    let game = {spirit:0, realm:0, realmLv:1, cult:0, roots:[1,1,1,1,1], rootLv:1, tech:[true], pet:null, sect:{train:0,alchemy:0,forge:0,park:0,array:0}, disciples:1, mission:null, missionTime:0, dungeon:null, lastSave:Date.now()};

    function getSpirits(){return Number(game.spirit)||0;}
    function getRealm(){return Number(game.realm)||0;}
    function getRealmLv(){return Number(game.realmLv)||1;}
    function getCult(){return Number(game.cult)||0;}
    function getRoots(){return (game.roots||[1,1,1,1,1]).map(r=>Number(r)||1);}
    function getDisciples(){return Number(game.disciples)||1;}

    function load(){
        try{
            let d=localStorage.getItem('xianxia_v3');
            if(d){
                game={...game,...JSON.parse(d)};
                game.spirit=getSpirits();game.realm=getRealm();game.realmLv=getRealmLv();game.cult=getCult();
                game.roots=getRoots();game.disciples=getDisciples();game.sect=game.sect||{train:0,alchemy:0,forge:0,park:0,array:0};
                game.tech=game.tech||[true];
                let offline=(Date.now()-game.lastSave)/1000;
                if(offline>60){game.spirit+=getRate()*offline*0.5;alert('ç¦»çº¿æ”¶ç›Š:+'+Math.floor(getRate()*offline*0.5)+'çµæ°”');}
            }
        }catch(e){}
    }

    function save(){game.lastSave=Date.now();localStorage.setItem('xianxia_v3',JSON.stringify(game));}

    function getRate(){
        let r=(game.realm+1)*game.realmLv*(1+game.sect.train*0.2);
        r*=(1+getRoots().reduce((a,b)=>a+b,0)*0.1);
        game.tech.forEach((ok,i)=>{if(ok && TECH[i].d.includes('çµæ°”'))r*=1.1;});
        return r;
    }

    function getNeed(){return Math.floor(100*Math.pow(1.5,game.realmLv));}
    function getCombat(){let c=10+game.realm*50+game.realmLv*5;c*=(1+game.sect.array*0.1);if(game.pet)c+=game.pet.a*10;return c;}

    function upgradeRoot(){
        let cost=Math.floor(10*Math.pow(1.5,game.rootLv));
        if(game.spirit>=cost){game.spirit-=cost;game.rootLv++;game.roots[Math.floor(Math.random()*5)]++;}
        render();
    }

    function learnTech(i){
        if(game.tech[i])return;
        if(game.spirit>=TECH[i].c){game.spirit-=TECH[i].c;game.tech[i]=true;}
        render();
    }

    function upgradeSect(type){
        let costs={train:500,alchemy:300,forge:400,park:300,array:600};
        let cost=Math.floor(costs[type]*Math.pow(1.5,game.sect[type]));
        if(game.spirit>=cost){game.spirit-=cost;game.sect[type]++;}
        render();
    }

    function recruit(){
        let cost=200*game.disciples;
        if(game.spirit>=cost){game.spirit-=cost;game.disciples++;}
        render();
    }

    function mission(level){
        if(game.mission)return;
        let cost={easy:50,normal:200,hard:500};
        if(game.spirit>=cost[level]){game.spirit-=cost[level];game.mission=level;game.missionTime=30;
            document.getElementById('mission-status').textContent='å¼Ÿå­å†ç»ƒä¸­...';render();}
    }

    function catchPet(){
        if(game.spirit>=500){game.spirit-=500;game.pet=PETS[Math.floor(Math.random()*PETS.length)];game.pet.lv=1;}
        render();
    }

    function enterDungeon(){
        if(!game.dungeon)game.dungeon=Math.floor(Math.random()*DUNGEONS.length);
        let d=DUNGEONS[game.dungeon];
        if(getCombat()>=d.r){game.spirit+=d.r*10;alert('é€šå…³æˆåŠŸï¼è·å¾—'+d.reward);game.dungeon=null;}
        else alert('æˆ˜åŠ›ä¸è¶³ï¼éœ€è¦'+d.r+'æˆ˜åŠ›');
        render();
    }

    function showTab(t){
        document.querySelectorAll('.nav-btn').forEach(b=>b.classList.remove('active'));
        document.querySelectorAll('.panel').forEach(p=>p.classList.remove('active'));
        document.querySelector('[data-tab="'+t+'"]').classList.add('active');
        document.getElementById(t+'-panel').classList.add('active');
    }

    function render(){
        let realms = REALMS;
        document.getElementById('realm').textContent=realms[game.realm];
        document.getElementById('spirit').textContent=Math.floor(getSpirits()).toLocaleString();
        document.getElementById('realm-text').textContent=realms[game.realm]+'æœŸ ç¬¬'+game.realmLv+'å±‚';
        
        let need=getNeed();
        document.getElementById('cultivation').textContent=Math.floor(getCult());
        document.getElementById('need').textContent=need;
        document.getElementById('progress').style.width=(getCult()/need*100)+'%';
        document.getElementById('rate').textContent=getRate().toFixed(1);
        
        let elems=['é‡‘','æœ¨','æ°´','ç«','åœŸ'];
        document.getElementById('roots').innerHTML=elems.map((e,i)=>'<span class="root '+(getRoots()[i]>5?'active':'')+'">'+e+':'+getRoots()[i]+'</span>').join('');
        
        ['train','alchemy','forge','park','array'].forEach(b=>document.getElementById('b-'+b).textContent=game.sect[b]);
        document.getElementById('disciples').textContent=game.disciples;
        document.getElementById('max-disciples').textContent=5+game.sect.train*2;
        
        if(game.pet)document.getElementById('my-pet').innerHTML='<div style="font-size:3rem;">'+game.pet.i+'</div><p>'+game.pet.n+' Lv.'+game.pet.lv+'</p>';
        
        if(game.dungeon){
            let d=DUNGEONS[game.dungeon];
            document.getElementById('dungeon-name').textContent=d.n;
            document.getElementById('dungeon-desc').textContent=d.d+' (éœ€æˆ˜åŠ›:'+d.r+')';
        }else{
            document.getElementById('dungeon-name').textContent='ä»Šæ—¥å·²é€šå…³';
            document.getElementById('dungeon-desc').textContent='è¯·æ˜å¤©å†æ¥';
        }
        
        document.getElementById('tech-list').innerHTML=TECH.map((t,i)=>'<div class="tech-card" onclick="learnTech('+i+')"><div class="name">'+t.n+'</div><div class="desc">'+t.d+'</div><div class="cost">'+(game.tech[i]?'å·²å­¦ä¼š':t.c+'çµæ°”')+'</div></div>').join('');
        
        save();
    }

    setInterval(()=>{
        game.spirit+=getRate()/10;
        game.cult+=game.rootLv*0.1;
        if(game.cult>=getNeed()){game.cult=0;if(game.realmLv<10)game.realmLv++;else if(game.realm<9){game.realm++;game.realmLv=1;}}
        if(game.mission){game.missionTime--;if(game.missionTime<=0){game.spirit+={easy:100,normal:500,hard:2000}[game.mission];game.mission=null;document.getElementById('mission-status').textContent='ä»»åŠ¡å®Œæˆï¼';}}
        render();
    },100);

    setInterval(save,10000);
    load();
    </script>
</body>
</html>
